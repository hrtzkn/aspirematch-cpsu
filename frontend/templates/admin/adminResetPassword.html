<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN RESET PASSWORD</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/aspirematch.png') }}">
    <link href="/static/css/output.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col min-h-screen bg-[#f6ebcd]">
<header class="fixed top-0 left-0 right-0 bg-[#166D3B] text-[#f6ebcd] z-50">
    <div class="max-w-7xl mx-auto flex flex-col lg:flex-row items-center justify-center gap-0 lg:gap-4">
        <img src="/static/images/aspire.png" alt="AspireMatch Logo"
             class="h-14 lg:h-20 w-auto">

        <h1 class="text-center text-sm lg:text-2xl font-semibold tracking-wide leading-tight">
            ASPIREMATCH:
            <span class="font-light block lg:inline">
                A Career Interest Recommendation Application
            </span>
        </h1>
    </div>
</header>

<main class="flex-grow flex items-center justify-center px-4 pt-32 lg:pt-28">

    <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 lg:p-8">

        <h2 class="text-xl lg:text-2xl font-bold text-center mb-6">Set New Password</h2>

        {% if error %}
        <p class="text-red-600 text-center mb-4">{{ error }}</p>
        {% endif %}

        <form method="POST" class="space-y-6">

            <!-- NEW PASSWORD -->
            <div>
                <label class="block text-black mb-1">New Password</label>
                <div class="flex gap-2 items-center">
                    <input id="adminPassword"
                           type="password"
                           name="password"
                           required
                           class="flex-1 p-2 border border-[#166D3B] rounded-md focus:outline-none focus:ring-2 focus:ring-[#166D3B]"
                           onkeyup="checkPasswordStrength()"
                           placeholder="Enter new password">

                    <button type="button"
                            onclick="togglePassword(this)"
                            class="bg-yellow-500 text-white px-3 py-2 rounded-md hover:bg-yellow-700 text-sm">
                        Show
                    </button>

                    <button type="button"
                            onclick="copyPassword(this)"
                            class="bg-gray-500 text-white px-3 py-2 rounded-md hover:bg-gray-600 text-sm">
                        Copy
                    </button>
                </div>

                    <button type="button"
                            onclick="generateStrongPassword()"
                            class="bg-[#166D3B] text-white px-3 py-2 mt-2 rounded-md hover:bg-green-700 text-sm">
                        Suggest Password
                    </button>

                <!-- Strength Bar -->
                <div class="w-full h-2 bg-gray-300 rounded mt-2">
                    <div id="strengthBar" class="h-full w-0 rounded transition-all"></div>
                </div>

                <p id="passwordStrengthMsg" class="text-xs text-gray-600 mt-1"></p>

                <!-- Requirements -->
                <p class="text-[9px] lg:text-[10px] mt-2 text-gray-700">
                    <strong>Password must include:</strong>
                    <span id="reqUpper" class="text-red-600">❌ A-Z</span>,
                    <span id="reqLower" class="text-red-600">❌ a-z</span>,
                    <span id="reqNumber" class="text-red-600">❌ 0-9</span>,
                    <span id="reqSymbol" class="text-red-600">❌ symbol</span>,
                    <span id="reqLength" class="text-red-600">❌ 8 characters</span>
                </p>
            </div>

            <!-- CONFIRM PASSWORD -->
            <div>
                <label class="block text-black mb-1">Confirm Password</label>
                <input type="password"
                       name="confirm"
                       required
                       class="w-full p-2 border border-[#166D3B] rounded-md focus:outline-none focus:ring-2 focus:ring-[#166D3B]"
                       placeholder="Confirm new password">
            </div>

            <button type="submit"
                    class="w-full py-2 bg-[#166D3B] text-white rounded-md hover:bg-green-700 transition">
                Update Password
            </button>

        </form>
    </div>
</main>

<script>
function generateStrongPassword() {
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_-+=<>?";
    let password = "";

    for (let i = 0; i < 16; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
    }

    const pwField = document.getElementById("adminPassword");
    pwField.value = password;
    checkPasswordStrength();
}

function togglePassword(btn) {
    const pw = document.getElementById("adminPassword");

    if (pw.type === "password") {
        pw.type = "text";
        btn.innerText = "Hide";
    } else {
        pw.type = "password";
        btn.innerText = "Show";
    }
}

function copyPassword(btn) {
    const pw = document.getElementById("adminPassword");
    pw.select();
    pw.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(pw.value);

    btn.innerText = "✔ Copied";
    btn.classList.add("bg-green-600");

    setTimeout(() => {
        btn.innerText = "Copy";
        btn.classList.remove("bg-green-600");
    }, 2000);
}

function checkPasswordStrength() {
    const pw = document.getElementById("adminPassword").value;
    const bar = document.getElementById("strengthBar");
    const msg = document.getElementById("passwordStrengthMsg");

    let strength = 0;

    const hasUpper = /[A-Z]/.test(pw);
    const hasLower = /[a-z]/.test(pw);
    const hasNumber = /[0-9]/.test(pw);
    const hasSymbol = /[^A-Za-z0-9]/.test(pw);
    const hasLength = pw.length >= 8;

    updateReq("reqUpper", hasUpper, "A-Z");
    updateReq("reqLower", hasLower, "a-z");
    updateReq("reqNumber", hasNumber, "0-9");
    updateReq("reqSymbol", hasSymbol, "symbol");
    updateReq("reqLength", hasLength, "8 characters");

    function updateReq(id, valid, label) {
        const el = document.getElementById(id);
        el.className = valid ? "text-green-600" : "text-red-600";
        el.innerHTML = (valid ? "✔ " : "❌ ") + label;
    }

    if (hasUpper) strength++;
    if (hasLower) strength++;
    if (hasNumber) strength++;
    if (hasSymbol) strength++;
    if (hasLength) strength++;

    if (strength <= 2) {
        bar.style.width = "25%";
        bar.style.background = "red";
        msg.innerText = "Weak password";
    } else if (strength <= 4) {
        bar.style.width = "60%";
        bar.style.background = "orange";
        msg.innerText = "Medium strength";
    } else {
        bar.style.width = "100%";
        bar.style.background = "green";
        msg.innerText = "Strong password";
    }
}
</script>

</body>
</html>