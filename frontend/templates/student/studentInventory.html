<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STUDENT INVENTORY</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/aspirematch.png') }}">
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="flex flex-col min-h-screen bg-[#f6ebcd]">

{% include 'components/studentHeader.html' %}

<!-- MAIN CONTENT -->
<div class="flex flex-1 px-4 sm:px-6 lg:px-4">
    <main class="flex-grow flex items-center justify-center mt-[30px]">
        <div
            class="w-full max-w-3xl h-fit lg:h-[500px]
                   bg-white border border-[#166D3B]
                   rounded-2xl shadow-md
                   p-6 lg:p-10
                   text-center">

            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-[#166D3B]">
                INDIVIDUAL INVENTORY FORM
            </h1>

            <h2 class="text-base sm:text-lg font-bold mt-4">
                DISCLAIMER
            </h2>

            <p class="mt-3 indent-8 text-sm lg:text-base text-justify leading-relaxed">
                The information provided are true and accurate to the best of your knowledge.
                You also agree that the information provided herewith was prepared on your own
                free will, freely and voluntarily without any inducement, assurance or guarantee
                being made. You hereby attest to the completeness and accuracy of all the
                information you have given.
            </p>

            <p class="mt-3 indent-8 text-sm lg:text-base text-justify leading-relaxed">
                Further, you are also allowing the University to use and release the information
                for legitimate purposes. Likewise, you permit the University to release
                information only to authorized personnel for the above stated purpose in
                accordance with the Data Privacy Policy of the University.
            </p>

            <p class="mt-3 indent-8 text-sm lg:text-base text-justify leading-relaxed">
                You are aware that any act of dishonesty or falsification will lead to forfeiture
                of your application or dismissal from this University. The institution may also
                take further legal steps against fraudulent actions if the situation demands.
            </p>

<div class="mt-6">
    <button id="proceedBtn"
            class="inline-block w-full sm:w-auto px-4 py-2 bg-[#166D3B] text-white rounded-md font-semibold hover:bg-green-700 transition">
        PROCEED
    </button>
</div>
<!-- Modal -->
<div id="courseModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
    <div class="bg-white rounded-2xl p-6 sm:p-8 w-11/12 max-w-md text-center">
        <h3 class="text-xl font-bold text-[#166D3B]">Select Your Course</h3>

        <form id="courseForm" class="mt-4">
            <select name="course_name" id="courseSelect" required
                    class="w-full border border-gray-300 rounded-lg p-2 text-gray-700">
                <option value="">-- Select Course --</option>
                {% for program in programs %}
                <option value="{{ program }}">{{ program }}</option>
                {% endfor %}
            </select>

            <div class="mt-4 flex justify-between">
                <button type="button" id="cancelBtn"
                        class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Cancel</button>
                <button type="submit"
                        class="px-4 py-2 bg-[#166D3B] text-white rounded-lg hover:bg-green-700">Save</button>
            </div>
        </form>
    </div>
</div>

<div id="toast" class="flex items-center justify-center w-fit bg-green-500 text-white px-4 py-2 rounded-lg shadow-md opacity-0 transition-opacity duration-300 z-50">
    Course saved successfully âœ…
</div>

        </div>
    </main>
</div>

{% include 'components/footer.html' %}

<script>
const proceedBtn = document.getElementById("proceedBtn");
const courseModal = document.getElementById("courseModal");
const cancelBtn = document.getElementById("cancelBtn");
const courseForm = document.getElementById("courseForm");
const toast = document.getElementById("toast");

proceedBtn.addEventListener("click", () => {
    courseModal.classList.remove("hidden");
});

cancelBtn.addEventListener("click", () => {
    courseModal.classList.add("hidden");
});

courseForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const courseName = document.getElementById("courseSelect").value;

    if (!courseName) {
        alert("Please select a course!");
        return;
    }

    const formData = new FormData();
    formData.append("course_name", courseName);

    const response = await fetch("{{ url_for('student.save_course') }}", {
        method: "POST",
        body: formData
    });

    const result = await response.json();

    if (result.status === "success") {
        courseModal.classList.add("hidden");

        // Show temporary toast message
        toast.textContent = result.message;
        toast.classList.add("opacity-100");

        // Wait 3 seconds, then hide toast and redirect
        setTimeout(() => {
            toast.classList.remove("opacity-100");
            window.location.href = "{{ url_for('student.studentInventoryForm') }}";
        }, 2000);

    } else {
        alert(result.message || "An error occurred");
    }
});
</script>

</body>
</html>
